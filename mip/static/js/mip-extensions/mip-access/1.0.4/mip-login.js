define("mip-access/mip-login",["require","util"],function(t){function e(t){this._openWin,this._loginMap=[],this._loginConfig=t,this._href=window.location.href}var i=t("util"),n=i.fn;return e.prototype.bindEvent=function(){if(this._checkParam()){for(var t=document.querySelectorAll('[on="tap:mip-access.login"]'),e=document.querySelectorAll('[on="tap:mip-access.logout"]'),i=0;i<t.length;i++)t[i].addEventListener("click",this._login.bind(this));for(var n=0;n<e.length;n++)e[n].addEventListener("click",this._logout.bind(this))}},e.prototype._checkParam=function(){var t=this._loginConfig;if(!t||!n.isPlainObject(t))return!1;for(var e in t)if(t.hasOwnProperty(e))this._loginMap[e]=t[e];return!0},e.prototype._login=function(){if(this._loginMap&&this._loginMap.login){var t=this._loginMap.login,e=Math.floor(Math.min(700,.9*screen.width)),i=Math.floor(Math.min(450,.9*screen.height)),n=Math.floor((screen.width-e)/2),r=Math.floor((screen.height-i)/2),o="width="+e+",height="+i+",left="+n+",top="+r+",resizable=yes,scrollbars=yes";t=this._splice(t);try{this._openWin=window.open(t,"_blank",o)}catch(t){console.error("DOM","Failed to open url on target: _blank",t)}if(!this._openWin)this._openWin=window.open(t,"_top")}},e.prototype._logout=function(){if(this._loginMap&&this._loginMap.logout){var t=this._loginMap.logout;fetch(t,{credentials:"include"}).then(function(t){if(t.ok)window.location.reload()})}},e.prototype._splice=function(t){var e=t.split("?"),i=encodeURIComponent("https://mipcache.bdstatic.com/static/v1/mip-login-done/mip-login-done.html?url="+encodeURIComponent(this._href));if(e&&e.length>1)t+="&returnUrl="+i+"&url="+this._href;else t+="?returnUrl="+i+"&url="+this._href;return t},e});