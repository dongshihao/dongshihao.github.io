(window.MIP=window.MIP||[]).push({name:"mip-install-serviceworker",func:function(){define("mip-install-serviceworker/util",["require","exports"],function(t,e){function i(t,e){if(t.href=e,!t.protocol)t.href=t.href;var i={href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:"0"==t.port?"":t.port,pathname:t.pathname,search:t.search,hash:t.hash,origin:null};if("/"!==i.pathname[0])i.pathname="/"+i.pathname;if("http:"===i.protocol&&80==i.port||"https:"===i.protocol&&443==i.port)i.port="",i.host=i.hostname;if(t.origin&&"null"!==t.origin)i.origin=t.origin;else if("data:"===i.protocol||!i.host)i.origin=i.href;else i.origin=i.protocol+"//"+i.host;return i}e.isSecureUrl=function(t){if("string"==typeof t)t=this.parseUrl(t);return"https:"===t.protocol||"localhost"===t.hostname||this.endsWith(t.hostname,".localhost")},e.endsWith=function(t,e){var i=t.length-e.length;return i>=0&&t.indexOf(e,i)===i};var n,r={};e.parseUrl=function(t){if(!n)n=document.createElement("a");var e=r[t];if(e)return e;else return r[t]=i(n,t)},e.removeFragment=function(t){var e=t.indexOf("#");if(-1===e)return t;else return t.substring(0,e)}}),define("mip-install-serviceworker/urlRewriter",["require","./util","util"],function(t){function e(t,e,o){var s=this;this.urlMatchExpr=e,this.shellUrl=o,this.shellLoc=n.parseUrl(o),r.event.delegate(document,"a","click",function(t){i.call(s,t)})}function i(t){var e=t.target;if(e&&"A"===e.tagName&&e.href){var i=n.parseUrl(e.href);if(i.origin===this.shellLoc.origin&&i.pathname!==this.shellLoc.pathname&&this.urlMatchExpr.test(i.href)){if(e.getAttribute("i-miphtml-orig-href"))return;if(n.removeFragment(i.href)===n.removeFragment(window.location.href))return;e.setAttribute("i-miphtml-orig-href",e.href),e.href=this.shellUrl+"#href="+encodeURIComponent(i.pathname+i.search+i.hash)}}}var n=t("./util"),r=t("util");return e}),define("mip-install-serviceworker/mip-install-serviceworker",["require","util","viewer","./urlRewriter","./util","customElement"],function(t){function e(t){if(navigator.serviceWorker)navigator.serviceWorker.register(t).catch(function(t){console.error(t)})}var i=t("util"),n=t("viewer"),r=t("./urlRewriter"),o=t("./util"),s=o.parseUrl,a=t("customElement").create();return a.prototype.build=function(){if(!window.navigator.serviceWorker)return void this.maybeInstallUrlRewrite();var t=this.element;if(n.isIframed){var r=t.getAttribute("data-iframe-src");if(!r||!o.isSecureUrl(r))return;if(s(i.parseCacheUrl(window.location.href)).origin!==s(r).origin)return;var a=this;this._iframeTimer=setTimeout(function(){a.registerIframe(r)},15e3)}else{var l=t.getAttribute("src");if(s(window.location.href).origin!==s(l).origin)return;if(window.document&&"complete"===window.document.readyState)e(l);else window.addEventListener("load",function(){e(l)})}},a.prototype.viewportCallback=function(t){this.isInView=t},a.prototype.detachedCallback=function(){clearTimeout(this._iframeTimer),clearTimeout(this._preloadTimer)},a.prototype.registerIframe=function(t,e){if(this.isInView){var i=document.createElement("iframe");i.setAttribute("sandbox","allow-same-origin allow-scripts"),i.src=t+(e?"#"+e:""),i.style.display="none",i.onload=function(){i.parentElement.removeChild(i)},this.element.appendChild(i)}},a.prototype.maybeInstallUrlRewrite=function(){var t=this,e=t.element,i=e.getAttribute("data-no-service-worker-fallback-url-match"),s=e.getAttribute("data-no-service-worker-fallback-shell-url");if(i||s)if((s=o.removeFragment(s))&&o.isSecureUrl(s)){var a;try{a=new RegExp(i)}catch(t){throw new Error('Invalid "data-no-service-worker-fallback-url-match" expression',t)}new r(n,a,s),t._preloadTimer=setTimeout(function(){t.registerIframe(s,"preload")})}},a}),define("mip-install-serviceworker",["mip-install-serviceworker/mip-install-serviceworker"],function(t){return t}),function(){function t(t,e){t.registerMipElement("mip-install-serviceworker",e)}if(window.MIP)require(["mip-install-serviceworker"],function(e){t(window.MIP,e)});else require(["mip","mip-install-serviceworker"],t)}()}});